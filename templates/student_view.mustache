<div class="smartspe-student-evaluation">
    <h2>{{fullname}}</h2>
    <h3>Evaluating: {{evaluatee_name}}</h3>

    <p class="text-muted">
        {{#is_self}}
        You will start by evaluating yourself. Be honest and consistent. All responses are confidential.
        {{/is_self}}
        {{#is_peer}}
        You have completed your self-evaluation. Now, evaluate your teammate. Be fair and constructive.
        {{/is_peer}}
    </p>

    <form method="post" action="student_evaluate.php?id={{cmid}}" id="evaluation-form">
        <input type="hidden" name="sesskey" value="{{sesskey}}">
        <input type="hidden" name="action" value="" id="form-action">
        <!-- current displayed evaluatee (do NOT overwrite this on button click) -->
        <input type="hidden" name="current_evaluateeid" value="{{evaluateeid}}" id="current_evaluateeid">
        <!-- target evaluatee for navigation (set by buttons) -->
        <input type="hidden" name="evaluateeid" value="{{evaluateeid}}" id="evaluateeid">

        {{#questions}}
        <div class="question-block mb-4 p-3 border rounded">
            <p><strong>Question {{display_number}}:</strong></p>
            <div class="mb-2">{{{text}}}</div>

            {{#qtype_mcq}}
            {{#options}}
            <div class="form-check">
                <input class="form-check-input" type="radio"
                       name="answer_{{display_number}}"
                       value="{{value}}"
                       {{#checked}}checked{{/checked}} required>
                <label class="form-check-label">{{{text}}}</label>
            </div>
            {{/options}}
            {{/qtype_mcq}}

            {{#qtype_essay}}
            <textarea name="answer_{{display_number}}" rows="4" class="form-control"
                      placeholder="Enter your comment here..." required>{{current_answer}}</textarea>
            {{/qtype_essay}}
        </div>
        {{/questions}}

        <div class="evaluation-actions mt-4 d-flex justify-content-between">
            {{#has_prev}}
            <button type="submit" class="btn btn-secondary"
                    onclick="setAction('back', {{prev_evaluateeid}})"
                    formnovalidate>
                <i class="fa fa-arrow-left"></i> Back
            </button>
            {{/has_prev}}


            <div>
                {{#has_next}}
                <button type="submit" class="btn btn-primary" onclick="setAction('next', {{next_evaluateeid}})">
                    Next Peer <i class="fa fa-arrow-right"></i>
                </button>
                {{/has_next}}

                {{#is_last}}
                <button type="submit" class="btn btn-success" onclick="setAction('submit', {{evaluateeid}})">
                    <i class="fa fa-check"></i> Submit All Evaluations
                </button>
                {{/is_last}}
            </div>
        </div>
    </form>
</div>

<script>
function setAction(action, evaluateeid) {
    document.getElementById('form-action').value = action;
    // set the target navigation id only (leave current_evaluateeid intact so server saves current page)
    document.getElementById('evaluateeid').value = evaluateeid;
}
</script>
